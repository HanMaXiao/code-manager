<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åˆ›å»ºé›†åˆ</title>
  <style>
    :root {
      --background: var(--vscode-input-background, #3c3c3c);
      --foreground: var(--vscode-input-foreground, #cccccc);
      --border: var(--vscode-input-border, #3c3c3c);
      --focus-border: var(--vscode-focusBorder, #007fd4);
      --button-background: var(--vscode-button-background, #0e639c);
      --button-hover: var(--vscode-button-hoverBackground, #1177bb);
      --button-foreground: var(--vscode-button-foreground, #ffffff);
    }

    body {
      font-family: var(--vscode-font-family, "Segoe WPC", "Segoe UI", sans-serif);
      font-size: var(--vscode-font-size, 13px);
      color: var(--foreground);
      background-color: var(--vscode-editor-background, #1e1e1e);
      margin: 0;
      padding: 20px;
    }

    .dialog-container {
      max-width: 400px;
      margin: 0 auto;
    }

    .dialog-header {
      margin-bottom: 20px;
      text-align: center;
    }

    .dialog-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 5px 0;
    }

    .dialog-subtitle {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999999);
      margin: 0;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .input-field {
      width: 100%;
      padding: 8px 12px;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 2px;
      color: var(--foreground);
      font-family: inherit;
      font-size: inherit;
      box-sizing: border-box;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--focus-border);
    }

    .color-picker-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 5px;
    }

    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: var(--focus-border);
      box-shadow: 0 0 0 2px rgba(0, 127, 212, 0.3);
    }

    .icon-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-top: 5px;
    }

    .icon-option {
      padding: 10px;
      text-align: center;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 16px;
    }

    .icon-option:hover {
      background: var(--vscode-list-hoverBackground, #2a2d2e);
    }

    .icon-option.selected {
      background: var(--vscode-list-activeSelectionBackground, #094771);
      border-color: var(--focus-border);
    }

    .file-preview {
      margin-top: 15px;
      padding: 12px;
      background: var(--vscode-sideBar-background, #252526);
      border-radius: 4px;
      border-left: 3px solid var(--selected-color, #45B7D1);
    }

    .file-preview-title {
      font-weight: 500;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .file-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      font-size: 12px;
    }

    .file-icon {
      color: var(--vscode-descriptionForeground, #999999);
    }

    .button-group {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 2px;
      font-family: inherit;
      font-size: inherit;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-primary {
      background: var(--button-background);
      color: var(--button-foreground);
    }

    .btn-primary:hover {
      background: var(--button-hover);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3a3d41);
      color: var(--vscode-button-secondaryForeground, #ffffff);
    }

    .btn-secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .empty-state {
      text-align: center;
      color: var(--vscode-descriptionForeground, #999999);
      font-size: 12px;
      padding: 20px 0;
    }
  </style>
</head>
<body>
  <div class="dialog-container">
    <div class="dialog-header">
      <h2 class="dialog-title">åˆ›å»ºé›†åˆ</h2>
      <p class="dialog-subtitle">å°†ç›¸å…³æ–‡ä»¶ç»„ç»‡åˆ°é›†åˆä¸­</p>
    </div>

    <form id="collectionForm">
      <div class="form-group">
        <label class="form-label" for="collectionName">é›†åˆåç§°</label>
        <input 
          type="text" 
          id="collectionName" 
          class="input-field" 
          placeholder="ä¾‹å¦‚ï¼šç”¨æˆ·ç®¡ç†æ¨¡å—"
          required
        >
      </div>

      <div class="form-group">
        <label class="form-label">é€‰æ‹©é¢œè‰²</label>
        <div class="color-picker-container" id="colorPicker">
          <!-- é¢œè‰²é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">é€‰æ‹©å›¾æ ‡</label>
        <div class="icon-grid" id="iconGrid">
          <!-- å›¾æ ‡é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <div class="file-preview">
        <div class="file-preview-title">
          <span>ğŸ“</span>
          <span>è¦æ·»åŠ çš„æ–‡ä»¶</span>
        </div>
        <div id="fileList">
          <div class="empty-state">æš‚æ— æ–‡ä»¶</div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" id="cancelBtn">å–æ¶ˆ</button>
        <button type="submit" class="btn btn-primary" id="createBtn">åˆ›å»ºé›†åˆ</button>
      </div>
    </form>
  </div>

  <script>
    const vscode = acquireVsCodeApi();
    
    // é¢„è®¾é¢œè‰²å’Œå›¾æ ‡æ•°æ®
    const presetColors = [
      '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
      '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
    ];
    
    const presetIcons = [
      'folder', 'repo', 'package', 'project', 'library',
      'box', 'archive', 'container', 'bundle', 'collection'
    ];
    
    let selectedColor = presetColors[2]; // é»˜è®¤è“è‰²
    let selectedIcon = presetIcons[0];   // é»˜è®¤æ–‡ä»¶å¤¹
    let selectedFiles = [];

    // åˆå§‹åŒ–é¢œè‰²é€‰æ‹©å™¨
    function initColorPicker() {
      const container = document.getElementById('colorPicker');
      container.innerHTML = '';
      
      presetColors.forEach(color => {
        const colorOption = document.createElement('div');
        colorOption.className = 'color-option';
        colorOption.style.backgroundColor = color;
        colorOption.dataset.color = color;
        
        if (color === selectedColor) {
          colorOption.classList.add('selected');
        }
        
        colorOption.addEventListener('click', () => {
          document.querySelectorAll('.color-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          colorOption.classList.add('selected');
          selectedColor = color;
          updatePreview(); // å®æ—¶æ›´æ–°é¢„è§ˆ
        });
        
        container.appendChild(colorOption);
      });
    }

    // åˆå§‹åŒ–å›¾æ ‡ç½‘æ ¼
    function initIconGrid() {
      const container = document.getElementById('iconGrid');
      container.innerHTML = '';
      
      presetIcons.forEach(icon => {
        const iconOption = document.createElement('div');
        iconOption.className = 'icon-option';
        iconOption.textContent = getIconSymbol(icon);
        iconOption.dataset.icon = icon;
        
        if (icon === selectedIcon) {
          iconOption.classList.add('selected');
        }
        
        iconOption.addEventListener('click', () => {
          document.querySelectorAll('.icon-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          iconOption.classList.add('selected');
          selectedIcon = icon;
          updatePreview(); // å®æ—¶æ›´æ–°é¢„è§ˆ
        });
        
        container.appendChild(iconOption);
      });
    }

    // è·å–å›¾æ ‡çš„ç¬¦å·è¡¨ç¤º
    function getIconSymbol(iconName) {
      const iconMap = {
        'folder': 'ğŸ“',
        'repo': 'ğŸ“¦',
        'package': 'ğŸ',
        'project': 'ğŸ—ï¸',
        'library': 'ğŸ“š',
        'box': 'ğŸ“¦',
        'archive': 'ğŸ—ƒï¸',
        'container': 'ğŸ“¦',
        'bundle': 'ë¬¶',
        'collection': 'ğŸ“‚'
      };
      return iconMap[iconName] || 'ğŸ“';
    }

    // æ›´æ–°é¢„è§ˆæ˜¾ç¤º
    function updatePreview() {
      const collectionName = document.getElementById('collectionName').value || 'é›†åˆåç§°';
      const previewTitle = document.querySelector('.file-preview-title');
      const previewIcon = previewTitle.querySelector('span:first-child');
      
      // æ›´æ–°å›¾æ ‡
      previewIcon.textContent = getIconSymbol(selectedIcon);
      previewIcon.style.color = selectedColor;
      
      // æ›´æ–°åç§°
      const nameSpan = previewTitle.querySelector('span:last-child');
      nameSpan.textContent = collectionName;
    }

    // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
    function updateFileList() {
      const fileList = document.getElementById('fileList');
      
      if (selectedFiles.length === 0) {
        fileList.innerHTML = '<div class="empty-state">æš‚æ— æ–‡ä»¶</div>';
        return;
      }
      
      fileList.innerHTML = selectedFiles.map(file => `
        <div class="file-item">
          <span class="file-icon">ğŸ“„</span>
          <span>${file}</span>
        </div>
      `).join('');
    }

    // è¡¨å•æäº¤å¤„ç†
    document.getElementById('collectionForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = document.getElementById('collectionName').value.trim();
      if (!name) {
        alert('è¯·è¾“å…¥é›†åˆåç§°');
        return;
      }
      
      vscode.postMessage({
        command: 'createCollection',
        data: {
          name: name,
          color: selectedColor,
          icon: selectedIcon,
          files: selectedFiles
        }
      });
    });

    // å–æ¶ˆæŒ‰é’®å¤„ç†
    document.getElementById('cancelBtn').addEventListener('click', () => {
      vscode.postMessage({
        command: 'cancel'
      });
    });

    // æ·»åŠ è¾“å…¥æ¡†å®æ—¶æ›´æ–°ç›‘å¬
    document.getElementById('collectionName').addEventListener('input', updatePreview);

    // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯
    window.addEventListener('message', event => {
      const message = event.data;
      
      switch (message.command) {
        case 'initialize':
          if (message.files) {
            selectedFiles = message.files;
            updateFileList();
          }
          break;
          
        case 'addFile':
          if (message.file && !selectedFiles.includes(message.file)) {
            selectedFiles.push(message.file);
            updateFileList();
          }
          break;
          
        case 'removeFile':
          if (message.file) {
            selectedFiles = selectedFiles.filter(f => f !== message.file);
            updateFileList();
          }
          break;
      }
    });

    // åˆå§‹åŒ–
    initColorPicker();
    initIconGrid();
    updateFileList();
    updatePreview(); // åˆå§‹åŒ–é¢„è§ˆ

    console.log('é›†åˆåˆ›å»ºå¯¹è¯æ¡†å·²åŠ è½½');
  </script>
</body>
</html>